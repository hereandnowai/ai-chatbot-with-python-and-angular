<div class="chat-container">
    <header class="chat-header">
        <h1>HereAndNow AI Assistant</h1>
        <div class="connection-status">
            @if (isConnected()) {
            <span class="status connected">‚óè Connected</span>
            } @else {
            <span class="status disconnected">‚óè Disconnected</span>
            }
        </div>
        <button type="button" class="clear-btn" (click)="clearChat()">
            Clear Chat
        </button>
    </header>

    <div class="messages-container" #messagesContainer>
        @for (message of messages(); track message.id) {
        <div class="message" [class]="'message-' + message.sender">
            <div class="message-content">
                <div class="message-text">{{ message.text }}</div>
                <div class="message-time">
                    {{ message.timestamp | date:'short' }}
                </div>
            </div>
        </div>
        }

        @if (isLoading()) {
        <div class="message message-bot">
            <div class="message-content">
                <div class="typing-indicator">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>
        }
    </div>

    <!-- File Upload Section -->
    @if (selectedFile()) {
    <div class="file-preview">
        <div class="file-info">
            <span class="file-icon">üìÑ</span>
            <span class="file-name">{{ selectedFile()!.name }}</span>
            <span class="file-size">({{ formatFileSize(selectedFile()!.size) }})</span>
            <button type="button" class="remove-file-btn" (click)="clearFile()">√ó</button>
        </div>
    </div>
    }

    <form class="message-input-container" (ngSubmit)="sendMessage()">
        <div class="input-group">
            <!-- File Upload Button -->
            <input #fileInput type="file" accept=".pdf,.txt,.docx,.csv" (change)="onFileSelected($event)"
                style="display: none;">

            <button type="button" class="file-upload-btn" (click)="fileInput.click()" [disabled]="!isConnected()"
                title="Upload file (.pdf, .txt, .docx, .csv)">
                üìé
            </button>

            <textarea [formControl]="messageControl"
                placeholder="Ask me about Angular development or upload a document for analysis..."
                class="message-input" rows="1" (keypress)="onKeyPress($event)" [disabled]="!isConnected()"
                (dragover)="onDragOver($event)" (drop)="onFileDrop($event)"></textarea>

            <button type="submit" class="send-button" [disabled]="!canSend() || !isConnected()">
                @if (isLoading()) {
                <span class="loading-spinner"></span>
                } @else {
                Send
                }
            </button>
        </div>

        <!-- Drag and Drop Zone -->
        @if (!selectedFile() && isConnected()) {
        <div class="drag-drop-zone" (dragover)="onDragOver($event)" (drop)="onFileDrop($event)"
            [class.dragover]="isDragOver()">
            <p>Drop files here or click the üìé button to upload</p>
            <small>Supported formats: PDF, TXT, DOCX, CSV</small>
        </div>
        }
    </form>
</div>